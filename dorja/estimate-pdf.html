<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" >
<title>Estimate PDF</title>
<link rel="icon" type="image/png" href="img/logo.png">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>

/* A4 Size */
.a4-container {
  width: 210mm;
  min-height: 297mm;
  padding: 20mm;
  margin: auto;
  background: white;
  box-shadow: 0 0 10px rgba(0,0,0,0.2);
}

@media print {
  body {
    background: white;
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
  }

  .no-print {
    display: none;
  }

  .a4-container {
    box-shadow: none;
    margin: 0;
  }

  .table-primary {
    background-color: #cfe2ff !important;
  }

  .text-primary {
    color: #0d6efd !important;
  }

  .text-success {
    color: #198754 !important;
  }
}

</style>
</head>

<body class="bg-light">

<div class="text-center my-3 no-print">
      <a href="index.html" class="btn btn-primary">
    Back
  </a>
  <button onclick="window.print()" class="btn btn-primary">
    Download / Print PDF
  </button>
</div>

<div class="a4-container">

<!-- Company Header -->
<div class="d-flex justify-content-between align-items-center mb-0">
  <div class="d-flex align-items-center">
    <img src="img/png-dorja.png" width="180" class="me-3">
    <div>
      <h3 class="fw-bold mb-1">Dorja The Creative Hub</h3>
      <small>
        Creative & Digital Solutions<br>
        Email: dorjathecreativehub@gmail.com<br>
        Phone: +91 9832280847
      </small>
    </div>
  </div>

  <div class="text-end">
    <h4 class="fw-bold text-primary">ESTIMATE</h4>
    <small>
      Date: <span id="pdfDate"></span>
    </small>
  </div>
</div>

<hr>

<!-- Client Section -->
<div class="mb-0" id="estimateToSection">
  <strong id="estimateLabel">Estimate To:</strong><br>
  <span id="pdfClient" class="fw-semibold"></span><br>
</div>
<div class="mb-4">
  <span class="text-primary fw-bold" id="pdfDuration"></span>
</div>
<!-- Services Table -->
<table class="table table-bordered align-middle">
  <thead class="table-primary text-center">
    <tr id="pdfHead"></tr>
  </thead>
  <tbody id="pdfTable"></tbody>
</table>

<!-- Grand Total -->
<div class="d-flex justify-content-end mt-3">
  <div class="border p-2 text-end" style="width:250px;">
    <h6 class="mb-1">
      Estimated Total 
      <span class="text-success">₹</span> 
      <span class="text-success" id="pdfTotal"></span>
    </h6>
  </div>
</div>

<!-- Terms -->
<div class="mt-3 mb-4">
  <h6 class="fw-bold">Terms & Conditions:</h6>
  <ul class="small">
    <li>50% advance payment required before work starts.</li>
    <li>Final delivery after full payment clearance.</li>
    <li>Taxes (if applicable) extra.</li>
  </ul>
</div>

<!-- Signature -->
<div class="d-flex justify-content-between mt-5">
  <div>
    <p class="small text-muted">Client Signature</p>
  </div>
  <div class="text-end">
    <p class="small text-muted">Authorized Signature</p>
    <strong>Dorja The Creative Hub</strong>
  </div>
</div>

<hr class="mt-5">

<div class="mt-2 text-center">
  <p class="small text-muted">
    This estimate is generated by <strong>Dorja The Creative Hub Software</strong>. 
    It is a system-generated document and does not require a signature.
  </p>
</div>

</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script src="js/firebaseconfig.js"></script>

<script>
const database = firebase.database();

firebase.auth().onAuthStateChanged(function(user){

  if(!user){
    window.location.href = "login.html";
    return;
  }

  const urlParams = new URLSearchParams(window.location.search);
  const estimateId = urlParams.get("id");

  if(!estimateId){
    alert("Invalid Estimate");
    return;
  }

  database.ref("estimate/" + user.uid + "/" + estimateId)
    .once("value", function(snapshot){

      const data = snapshot.val();
      if(!data) return;

      const clientName = data.client || "";
    const estimateSection = document.getElementById("estimateToSection");

document.getElementById("pdfClient").innerText = clientName;

// If client name empty → hide full section
if (!clientName.trim()) {
  estimateSection.classList.add("d-none");
} else {
  estimateSection.classList.remove("d-none");
}
      document.getElementById("pdfDuration").innerText = data.duration || "";
      document.getElementById("pdfDate").innerText = data.updatedAt 
        ? new Date(data.updatedAt).toLocaleDateString()
        : "";
      document.getElementById("pdfTotal").innerText = data.grandTotal || "0";

      const table = document.getElementById("pdfTable");
      const head = document.getElementById("pdfHead");

      table.innerHTML = "";

      if(data.packageMode){

        head.innerHTML = `
          <th width="50">#</th>
          <th>Service</th>
          <th width="80" class="text-center">Qty</th>
          <th>Remarks</th>`;

        data.services.forEach((item, index)=>{
          table.innerHTML += `
            <tr>
              <td class="text-center">${index + 1}</td>
              <td>${item.service || ""}</td>
              <td class="text-center">${item.qty || ""}</td>
              <td>${item.remarks || ""}</td>
            </tr>`;
        });

      } else {

        head.innerHTML = `
          <th width="50">#</th>
          <th>Service</th>
          <th width="80" class="text-center">Qty</th>
          <th width="100">Amount</th>
          <th width="120">Total</th>
          <th>Remarks</th>`;

        data.services.forEach((item, index)=>{
          table.innerHTML += `
            <tr>
              <td class="text-center">${index + 1}</td>
              <td>${item.service || ""}</td>
              <td class="text-center">${item.qty || ""}</td>
              <td>${item.amount ? "₹ " + item.amount : ""}</td>
              <td>${item.total ? "₹ " + item.total : ""}</td>
              <td>${item.remarks || ""}</td>
            </tr>`;
        });

      }

    });

});

</script>

</body>
</html>