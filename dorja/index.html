<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Dorja | Estimate</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0d6efd">
<link rel="icon" type="image/png" href="img/logo.png">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="style/style.css" rel="stylesheet">
</head>

<body>

<div class="container-fluid mt-2">
<div class="card shadow-lg">
<div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
<h4 class="mb-0">Estimate</h4>

              <div class="dropdown">
              <button class="btn btn-light text-dark py-2" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                <strong>â‹®</strong>
              </button>
              <ul class="dropdown-menu dropdown-menu-end">
                <li>
                  <a href="estimate-list.html" class="dropdown-item">
                  ğŸ‘ View Estimate
                    </a>
                </li>
                <li>
                 <a href="services.html" class="dropdown-item">
                 ğŸ‘¨ğŸ»â€ğŸ’» Service
                 </a>
                </li>
                <li>
                 <a href="preset.html" class="dropdown-item">
                 ğŸ“¦ Packages
                 </a>
                </li>
                  <li class="nav-item mt-3">
                  <a class="bg-danger text-light dropdown-item" onclick="logout()" href="#">
                  ã€â»ã€‘ Logout
                </a>
              </li>
              </ul>
            </div>

 
 
</div>

<div class="card-body">

<!-- Client + Package Toggle -->
<div class="row align-items-end">

  <!-- Client Name -->
  <div class="col-8 col-md-6">
    <label class="form-label">Estimate For (Mr/Ms)</label>
    <input type="text" id="clientName" class="form-control" placeholder="Client Name">
  </div>

  <!-- Package Toggle -->
  <div class="col-4 col-md-3 d-flex align-items-end">
    <div class="form-check form-switch ms-auto">
      <input class="form-check-input" type="checkbox" id="packageToggle" onchange="toggleMode()">
      <!-- Hide text on small screens -->
      <label class="form-check-label d-none d-md-inline">
        Enable Package Mode
      </label>
    </div>
  </div>

  <!-- Package Amount -->
  <div class="col-12 col-md-3 mt-2 mt-md-0" id="packageAmountBox" style="display: none;">
    <label class="form-label d-none d-md-inline">Package Amount (â‚¹)</label>
    <input type="number" id="packageAmount" class="form-control" placeholder="Package Amount" oninput="updatePackageTotal()">
  </div>

</div>

<!-- Duration -->
<div class="row mt-3">
  <div class="col-12 col-md-4">
    <label class="form-label d-none d-md-inline">Duration</label>
    <select id="duration" class="form-select">
      <option>â³ Duration: One Week</option>
      <option>â³ Duration: One Month</option>
      <option>â³ Duration: One Year</option>
      <option>â³ Duration: Not Needed</option>
    </select>
  </div>
</div>

<hr>

<!-- Add Service Section -->
<div class="row g-2">

  <!-- Service Type -->
  <div class="col-12 col-md-3">
    <label class="form-label d-none d-md-inline">Service Type</label>
    <select id="serviceType" class="form-select" onchange="loadServicesByType()">
      <option value="">Select Service Type</option>
      <option value="Web Services">Web Services</option>
      <option value="Media Services">Media Services</option>
      <option value="Social Media Services">Social Media Services</option>
      <option value="Printing">Printing</option>
    </select>
  </div>

  <!-- Service -->
  <div class="col-12 col-md-3">
    <label class="form-label d-none d-md-inline">Service</label>
    <select id="service" class="form-select" disabled onchange="setServiceAmount()">
      <option value="">Select Service Type First</option>
    </select>
  </div>

  <!-- Quantity -->
  <div class="col-6 col-md-1 ">
    <label class="form-label d-none d-md-inline">Quantity</label>
    <input type="number" id="quantity" class="form-control" placeholder="Quantity">
  </div>

  <!-- Amount -->
  <div class="col-6 col-md-2" id="amountBox">
    <label class="form-label d-none d-md-inline" >Amount (â‚¹)</label>
    <input type="number" id="amount" class="form-control" placeholder="Amount" readonly>
  </div>

  <!-- Remarks -->
  <div class="col-12 col-md-2">
    <label class="form-label d-none d-md-inline">Remarks</label>
    <input type="text" id="remarks" class="form-control" placeholder="Remarks">
  </div>

  <!-- Add Button -->
  <div class="col-12 col-md-1 d-flex align-items-end">
    <button class="btn btn-success w-100" onclick="addService()">âœš</button>
  </div>

</div>

<hr>


<!-- Services Card List -->
<div id="estimateTable" class="mt-3"></div>

<!-- Grand Total -->
<div class="text-end bg-primary text-white p-2 rounded">
  <h6 class="fw-bold mb-0">
    Grand Total: â‚¹ <span id="grandTotal">0</span>
  </h6>
</div>

<!-- Buttons -->
<div class="text-center mt-3">
  <button class="btn btn-primary" onclick="clearURLParams()">
    âœš New
  </button>

  <button class="btn btn-success" id="saveEstimateBtn" onclick="saveEstimate()">
    <span class="spinner-border spinner-border-sm d-none" id="saveSpinner" role="status" aria-hidden="true"></span>
    <span id="saveText">ğŸ’¾ Save <span class="d-none d-lg-inline">Estimate</span></span>
  </button>

  <button class="btn btn-success" id="generatePDFBtn" onclick="generatePDF()">
    <span class="spinner-border spinner-border-sm d-none" id="pdfSpinner" role="status" aria-hidden="true"></span>
    <span id="pdfText">ğŸ“„ <span class="d-none d-lg-inline">Generate </span>PDF</span>
  </button>
</div>

</div>
</div>

</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="js/firebaseconfig.js"></script>

<script>
const database = firebase.database();

let estimateRef = null;
let estimateData = [];
let grandTotal = 0;
let currentUser = null;
let servicesByType = {};
let isSaving = false;
let isGeneratingPDF = false;

// ================= AUTH CHECK =================
firebase.auth().onAuthStateChanged(function(user){

  if(user){
    currentUser = user;
    
    // Load all services for this user
    loadAllServices();

    const urlParams = new URLSearchParams(window.location.search);
    const estimateId = urlParams.get("id");
    const usePackage = urlParams.get("usePackage");

    if(estimateId){
      // Load Existing Estimate
      estimateRef = database
        .ref("estimate/" + user.uid + "/" + estimateId);
      loadEstimate();
    } else {
      // Create New Estimate
      estimateRef = database
        .ref("estimate/" + user.uid)
        .push();
      
      // Check if we need to load a package
      if(usePackage) {
        // Small delay to ensure services are loaded
        setTimeout(() => {
          loadPackagePreset(usePackage);
        }, 1000);
      }
    }

  } else {
    window.location.href = "login.html";
  }

});

// ================= LOAD ALL SERVICES =================
function loadAllServices(){
  const servicesRef = database.ref("services/" + currentUser.uid);
  
  servicesRef.once("value", function(snapshot){
    if(snapshot.exists()){
      servicesByType = {};
      
      snapshot.forEach(function(child){
        const service = child.val();
        const type = service.type;
        
        if(!servicesByType[type]){
          servicesByType[type] = [];
        }
        
        servicesByType[type].push({
          id: child.key,
          name: service.name,
          amount: service.amount || 0,
          remarks: service.remarks || ""
        });
      });
      
      console.log("Services loaded:", servicesByType);
    }
  }, function(error){
    console.error("Error loading services:", error);
    alert("Error loading services. Please refresh the page.");
  });
}

// ================= LOAD PACKAGE PRESET =================
function loadPackagePreset(packageId) {
    if (!currentUser) {
        console.log("No current user");
        return;
    }
    
    console.log("Loading package:", packageId);
    
    // Ensure estimateRef exists
    if (!estimateRef) {
        estimateRef = database
            .ref("estimate/" + currentUser.uid)
            .push();
    }
    
    const packageRef = database.ref("packages/" + currentUser.uid + "/" + packageId);
    
    packageRef.once("value", function(snapshot) {
        const pkg = snapshot.val();
        if (!pkg) {
            console.log("Package not found");
            return;
        }
        
        console.log("Package loaded:", pkg);
        
        // Enable package mode
        document.getElementById("packageToggle").checked = true;
        toggleMode(true);
        
        // Set package details
        document.getElementById("packageAmount").value = pkg.amount;
        document.getElementById("duration").value = pkg.duration || "â³ Duration: Not Needed";
        
        // Clear existing data
        grandTotal = parseFloat(pkg.amount) || 0;
        estimateData = [];
        document.getElementById("estimateTable").innerHTML = "";
        
        // Add services from package
        if (pkg.services && pkg.services.length > 0) {
            pkg.services.forEach(service => {
                const container = document.getElementById("estimateTable");
container.innerHTML = "";

if (pkg.services && pkg.services.length > 0) {
  pkg.services.forEach(service => {

    const card = document.createElement("div");
    card.className = "card  mb-2";

    card.innerHTML = `
      <div class="card-body d-flex justify-content-between align-items-center">
        <div>
          <h6 class="mb-1 my-text fw-bold">ğŸ‘¨ğŸ»â€ğŸ’» ${service.service} Qty: ${service.quantity || 1}</h6>
          <small class="my-text2 fw-bold">${service.remarks || ""}</small>
        </div>
        <button class="btn btn-danger btn-sm"
          onclick="deleteCard(this)">
          ğŸ—‘ï¸<span class="d-none d-lg-inline">Delete</span>
        </button>
      </div>
    `;

    container.appendChild(card);

    estimateData.push({
      service: service.service,
      qty: service.quantity || 1,
      remarks: service.remarks || "",
      serviceType: service.serviceType || ""
    });
  });
}
            })}
        
        // Update grand total
        document.getElementById("grandTotal").innerText = grandTotal;
        
        alert("Package loaded successfully!");
    }).catch(function(error) {
        console.error("Error loading package:", error);
        alert("Error loading package: " + error.message);
    });
}

// ================= LOAD SERVICES BY TYPE =================
function loadServicesByType(){
  const serviceType = document.getElementById("serviceType").value;
  const serviceSelect = document.getElementById("service");
  const amountInput = document.getElementById("amount");
  const remarksInput = document.getElementById("remarks");
  
  // Clear and disable service select if no type selected
  if(!serviceType){
    serviceSelect.innerHTML = '<option value="">Select Service Type First</option>';
    serviceSelect.disabled = true;
    amountInput.value = "";
    remarksInput.value = "";
    return;
  }
  
  // Get services for selected type
  const services = servicesByType[serviceType] || [];
  
  // Populate service dropdown
  let options = '<option value="">Select Service</option>';
  services.forEach(service => {
    const remarksText = service.remarks ? ` (${service.remarks.substring(0, 20)}${service.remarks.length > 20 ? '...' : ''})` : '';
    options += `<option value="${service.name}" data-amount="${service.amount}" data-id="${service.id}">${service.name} - â‚¹${service.amount}${remarksText}</option>`;
  });
  
  serviceSelect.innerHTML = options;
  serviceSelect.disabled = false;
  amountInput.value = "";
  remarksInput.value = "";
}

// ================= SET SERVICE AMOUNT AND REMARKS =================
function setServiceAmount(){
  const serviceSelect = document.getElementById("service");
  const amountInput = document.getElementById("amount");
  const remarksInput = document.getElementById("remarks");
  const quantityInput = document.getElementById("quantity");
  const selectedOption = serviceSelect.options[serviceSelect.selectedIndex];
  
  if(selectedOption && selectedOption.value){
    const amount = selectedOption.getAttribute("data-amount");
    const serviceId = selectedOption.getAttribute("data-id");
    
    // Set amount
    amountInput.value = amount || 0;
    
    // Set quantity to 1 by default
    quantityInput.value = 1;
    
    // Find and set remarks from the service data
    const serviceType = document.getElementById("serviceType").value;
    const services = servicesByType[serviceType] || [];
    const selectedService = services.find(s => s.id === serviceId);
    
    if(selectedService && selectedService.remarks) {
      remarksInput.value = selectedService.remarks;
    } else {
      remarksInput.value = "";
    }
  } else {
    amountInput.value = "";
    remarksInput.value = "";
    // Optionally clear quantity when no service is selected
    // quantityInput.value = "";
  }
}

// ================= TOGGLE MODE =================
function toggleMode(isLoading = false) {
  const toggle = document.getElementById("packageToggle");
  const packageBox = document.getElementById("packageAmountBox");
  const amountBox = document.getElementById("amountBox");

  packageBox.style.display = toggle.checked ? "block" : "none";
  amountBox.style.display = toggle.checked ? "none" : "block";

  if (!isLoading) {
    grandTotal = 0;
    estimateData = [];
    document.getElementById("estimateTable").innerHTML = "";
    document.getElementById("grandTotal").innerText = 0;
    document.getElementById("packageAmount").value = "";
  }
}

// ================= PACKAGE TOTAL =================
function updatePackageTotal() {
  const amount = document.getElementById("packageAmount").value;
  document.getElementById("grandTotal").innerText = amount ? amount : 0;
}

// ================= ADD SERVICE =================
// ================= ADD SERVICE =================
function addService() {
  const toggle = document.getElementById("packageToggle").checked;
  const serviceType = document.getElementById("serviceType").value;
  const service = document.getElementById("service").value;
  const qty = parseInt(document.getElementById("quantity").value);
  const remarks = document.getElementById("remarks").value;

  if (!serviceType || !service || !qty) {
    alert("Please select Service Type, Service and enter Quantity!");
    return;
  }

  const container = document.getElementById("estimateTable");

  // ğŸ” Check if service already exists
  const existingIndex = estimateData.findIndex(item => item.service === service);

  // ================= PACKAGE MODE =================
  if (toggle) {

    if (existingIndex !== -1) {
      // âœ… Update quantity
      estimateData[existingIndex].qty += qty;

      // Update UI
      const cards = container.querySelectorAll(".card");
      cards[existingIndex].querySelector("h6").innerHTML =
        `ğŸ‘¨ğŸ»â€ğŸ’» ${service} Qty: ${estimateData[existingIndex].qty}`;

      return;
    }

    // â• Create New Card
    const card = document.createElement("div");
    card.className = "card mb-2";
    card.innerHTML = `
      <div class="card-body d-flex justify-content-between align-items-center">
        <div>
          <h6 class="mb-1 fw-bold">ğŸ‘¨ğŸ»â€ğŸ’» ${service} Qty: ${qty}</h6>
          <small class="fw-bold">${remarks}</small>
        </div>
        <button class="btn btn-danger btn-sm" onclick="deleteCard(this)"> 
          ğŸ—‘ï¸ <span class="d-none d-lg-inline">Delete</span>
        </button>
      </div>
    `;

    container.appendChild(card);
    estimateData.push({ service, qty, remarks, serviceType });

  } 
  // ================= NORMAL MODE =================
  else {

    const amount = parseFloat(document.getElementById("amount").value);
    if (!amount) {
      alert("Amount is required!");
      return;
    }

    if (existingIndex !== -1) {
      // âœ… Update quantity & total
      estimateData[existingIndex].qty += qty;
      estimateData[existingIndex].total =
        estimateData[existingIndex].qty * estimateData[existingIndex].amount;

      // ğŸ”„ Recalculate Grand Total
      grandTotal = 0;
      estimateData.forEach(item => {
        if (item.total) grandTotal += item.total;
      });

      document.getElementById("grandTotal").innerText = grandTotal;

      // Update UI
      const cards = container.querySelectorAll(".card");
      cards[existingIndex].querySelector("small").innerHTML =
        `Qty: ${estimateData[existingIndex].qty} | Total: â‚¹ ${estimateData[existingIndex].total}`;

      return;
    }

    // â• New Service
    const total = qty * amount;
    grandTotal += total;
    document.getElementById("grandTotal").innerText = grandTotal;

    const card = document.createElement("div");
    card.className = "card mb-2";
    card.innerHTML = `
      <div class="card-body d-flex justify-content-between align-items-center">
        <div>
          <h6 class="mb-1 fw-bold">ğŸ‘¨ğŸ»â€ğŸ’» ${service} â‚¹ ${amount}</h6>
          <small class="fw-bold">Qty: ${qty} | Total: â‚¹ ${total}</small><br>
          <small class="fw-bold">${remarks}</small>
        </div>
        <button class="btn btn-danger btn-sm" onclick="deleteCard(this, ${total})">
          ğŸ—‘ï¸ <span class="d-none d-lg-inline">Delete</span>
        </button>
      </div>
    `;

    container.appendChild(card);
    estimateData.push({ service, qty, amount, total, remarks, serviceType });
  }

  // ğŸ”„ Reset fields
  document.getElementById("quantity").value = "1";
  document.getElementById("remarks").value = "";
  document.getElementById("service").value = "";
  document.getElementById("amount").value = "";
}

// ================= DELETE ROW =================
function deleteCard(btn, total = 0) {
  const card = btn.closest(".card");
  card.remove();

  if (total) {
    grandTotal -= total;
    document.getElementById("grandTotal").innerText = grandTotal;
  }

  // Rebuild estimateData from cards
  estimateData = [];
  const cards = document.querySelectorAll("#estimateTable .card");

  cards.forEach(card => {
    const text = card.innerText;

    if (document.getElementById("packageToggle").checked) {
      estimateData.push({
        service: text.split("\n")[0],
        qty: parseInt(text.match(/Qty: (\d+)/)[1]),
        remarks: ""
      });
    } else {
      const service = text.split("\n")[0];
      const qty = parseInt(text.match(/Qty: (\d+)/)[1]);
      const amount = parseFloat(text.match(/â‚¹ (\d+)/)[1]);
      const total = parseFloat(text.match(/Total: â‚¹ (\d+)/)[1]);

      estimateData.push({
        service,
        qty,
        amount,
        total,
        remarks: ""
      });
    }
  });
}

// ================= SAVE ESTIMATE =================
function saveEstimate() {
  // Prevent double submission
  if (isSaving) return;
  
  // Show loader
  isSaving = true;
  document.getElementById('saveSpinner').classList.remove('d-none');
  document.getElementById('saveEstimateBtn').disabled = true;
  document.getElementById('saveText').innerHTML = 'Saving...';

  if (!estimateRef) {
    alert("Estimate not initialized yet!");
    hideSaveLoader();
    return;
  }

  if (!currentUser) {
    alert("Please login first!");
    window.location.href = "login.html";
    return;
  }

  // Check if at least one service exists
  if (estimateData.length === 0) {
    alert("Please add at least one service before saving!");
    hideSaveLoader();
    return;
  }

  const rawClientName = document.getElementById("clientName").value.trim();

  if (rawClientName === "") {
    alert("Client name is required!");
    hideSaveLoader();
    return;
  }

  let formattedClientName = rawClientName.startsWith("ğŸ‘¤")
    ? rawClientName
    : "ğŸ‘¤ " + rawClientName;

  const data = {
    client: formattedClientName,
    duration: document.getElementById("duration").value,
    packageMode: document.getElementById("packageToggle").checked,
    packageAmount: document.getElementById("packageAmount").value || 0,
    grandTotal: document.getElementById("grandTotal").innerText,
    services: estimateData,
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString()
  };

  estimateRef.set(data)
    .then(() => {
      alert("Estimate saved successfully!");
      hideSaveLoader();
    })
    .catch(error => {
      alert("Error saving estimate: " + error.message);
      hideSaveLoader();
    });
}

// Helper function to hide save loader
function hideSaveLoader() {
  isSaving = false;
  document.getElementById('saveSpinner').classList.add('d-none');
  document.getElementById('saveEstimateBtn').disabled = false;
  document.getElementById('saveText').innerHTML = 'ğŸ’¾ Save <span class="d-none d-lg-inline">Estimate</span>';
}

// ================= LOAD EXISTING ESTIMATE =================
// ================= LOAD EXISTING ESTIMATE =================
function loadEstimate(){
  if(!estimateRef) return;

  estimateRef.once("value", function(snapshot){
    const data = snapshot.val();
    if(!data) return;

    document.getElementById("clientName").value = data.client || "";
    document.getElementById("duration").value = data.duration || "Week";
    document.getElementById("packageToggle").checked = data.packageMode || false;
    document.getElementById("packageAmount").value = data.packageAmount || 0;
    document.getElementById("grandTotal").innerText = data.grandTotal || 0;

    // Update UI without clearing data
    toggleMode(true);

    estimateData = data.services || [];
    grandTotal = parseFloat(data.grandTotal) || 0;

    const container = document.getElementById("estimateTable");
    container.innerHTML = "";

    // Recreate cards for each service
    estimateData.forEach(service => {
      const card = document.createElement("div");
      card.className = "card mb-2";

      if(data.packageMode){
        card.innerHTML = `
          <div class="card-body d-flex justify-content-between align-items-center">
            <div>
              <h6 class="mb-1 my-text fw-bold">ğŸ‘¨ğŸ»â€ğŸ’» ${service.service} | Qty: ${service.qty}</h6>
              <small class="my-text2 fw-bold">${service.remarks || ""}</small>
            </div>
            <button class="btn btn-danger btn-sm" onclick="deleteCard(this)">ğŸ—‘ï¸<span class="d-none d-lg-inline">Delete</span></button>
          </div>
        `;
      } else {
        const total = service.total || (service.qty * service.amount);
        card.innerHTML = `
          <div class="card-body d-flex justify-content-between align-items-center">
            <div>
              <h6 class="mb-1 my-text">ğŸ‘¨ğŸ»â€ğŸ’» ${service.service}  â‚¹ ${service.amount}</h6>
              <small class="my-text2 fw-bold">Qty: ${service.qty} | Total: â‚¹ ${total}</small> <br>
              <small class="my-text2 fw-bold">${service.remarks || ""}</small>
            </div>
            <button class="btn btn-danger btn-sm" onclick="deleteCard(this, ${total})">ğŸ—‘ï¸<span class="d-none d-lg-inline">Delete</span></button>
          </div>
        `;
      }

      container.appendChild(card);
    });
  });
}

// ================= GENERATE PDF =================
function generatePDF() {
  // Prevent double submission
  if (isGeneratingPDF) return;
  
  // Show loader
  isGeneratingPDF = true;
  document.getElementById('pdfSpinner').classList.remove('d-none');
  document.getElementById('generatePDFBtn').disabled = true;
  document.getElementById('pdfText').innerHTML = 'Generating...';

  if (!estimateRef) {
    alert("Estimate not ready yet!");
    hidePDFLoader();
    return;
  }

     const rawClientName = document.getElementById("clientName").value.trim();

  if (rawClientName === "") {
    alert("Client name is required!");
    hidePDFLoader();
    return;
  }

  // Check if estimate is saved
  if (!estimateRef.key) {
    alert("Please save the estimate first before generating PDF!");
    hidePDFLoader();
    return;
  }

  // Check if at least one service added
  if (estimateData.length === 0) {
    alert("Please add at least one service before generating PDF!");
    hidePDFLoader();
    return;
  }

  const estimateId = estimateRef.key;
  
  // Small delay to show loader
  setTimeout(() => {
    window.location.href = "estimate-pdf.html?id=" + estimateId;
  }, 500);
}

// Helper function to hide PDF loader
function hidePDFLoader() {
  isGeneratingPDF = false;
  document.getElementById('pdfSpinner').classList.add('d-none');
  document.getElementById('generatePDFBtn').disabled = false;
  document.getElementById('pdfText').innerHTML = 'ğŸ“„ <span class="d-none d-lg-inline">Generate </span>PDF';
}

function clearURLParams() {
  // Remove everything after ?
  const cleanURL = window.location.origin + window.location.pathname;
  // Replace URL without reloading first
  window.history.replaceState({}, document.title, cleanURL);
  // Now reload the page
  window.location.reload();
}

// Logout function
function logout() {
  firebase.auth().signOut()
    .then(() => {
      window.location.href = "login.html";
    })
    .catch((error) => {
      alert("Logout failed: " + error.message);
    });
}

// Logout function
function logout() {
  firebase.auth().signOut()
    .then(() => {
      window.location.href = "login.html";
    })
    .catch((error) => {
      alert("Logout failed: " + error.message);
    });
}
</script>

<script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("sw.js")
   .then(() => console.log("Service Worker Registered"));
  }
</script>
</body>
</html>